<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Apicase | Requests</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/14.styles.069008a2.css" as="style"><link rel="preload" href="/assets/js/app.8395491c.js" as="script"><link rel="preload" href="/assets/js/8.80949565.js" as="script"><link rel="prefetch" href="/assets/js/6.116cf7b6.js"><link rel="prefetch" href="/assets/js/0.2ef4af48.js"><link rel="prefetch" href="/assets/js/1.fcd4327d.js"><link rel="prefetch" href="/assets/js/2.5faf6c39.js"><link rel="prefetch" href="/assets/js/3.278799db.js"><link rel="prefetch" href="/assets/js/4.63f4dde3.js"><link rel="prefetch" href="/assets/js/5.42f78ee0.js"><link rel="prefetch" href="/assets/js/7.ca515bf6.js"><link rel="prefetch" href="/assets/js/9.66a23df4.js"><link rel="prefetch" href="/assets/js/10.a00d6c64.js"><link rel="prefetch" href="/assets/js/11.a5f43c96.js"><link rel="prefetch" href="/assets/js/12.9018ccc1.js"><link rel="prefetch" href="/assets/js/13.40d0899f.js">
    <link rel="stylesheet" href="/assets/css/14.styles.069008a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Apicase
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Apicase</span><!----></p><ul class="sidebar-group-items"><li><a href="/" class="sidebar-link">Introduction</a></li><li><a href="/installation.html" class="sidebar-link">Installation</a></li><li><a href="/quick-start.html" class="sidebar-link">Quick start</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Anatomy</span><!----></p><ul class="sidebar-group-items"><li><a href="/anatomy/requests.html" class="active sidebar-link">Requests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/anatomy/requests.html#wrap-adapters" class="sidebar-link">Wrap adapters</a></li><li class="sidebar-sub-header"><a href="/anatomy/requests.html#request-structure" class="sidebar-link">Request structure</a></li><li class="sidebar-sub-header"><a href="/anatomy/requests.html#response-structure" class="sidebar-link">Response structure</a></li><li class="sidebar-sub-header"><a href="/anatomy/requests.html#request-flow" class="sidebar-link">Request flow</a></li><li class="sidebar-sub-header"><a href="/anatomy/requests.html#detecting-state-changes" class="sidebar-link">Detecting state changes</a></li></ul></li><li><a href="/anatomy/services.html" class="sidebar-link">Services</a></li><li><a href="/anatomy/spawner.html" class="sidebar-link">Spawner API</a></li><li><a href="/anatomy/adapters.html" class="sidebar-link">Adapters</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Migration info</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deprecated APIs</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="requests"><a href="#requests" aria-hidden="true" class="header-anchor">#</a> Requests</h1><p>Core function of Apicase is <code>apicase</code> (ba-dum-tss). It uses adapters, creates requests and does some good things.</p><h2 id="wrap-adapters"><a href="#wrap-adapters" aria-hidden="true" class="header-anchor">#</a> Wrap adapters</h2><p>Firstly, you need some adapter (e.g. <code>fetch</code>). Pass it to <code>apicase</code> and you'll get a function that works with this adapter:</p><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> apicase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@apicase/core&quot;</span>
<span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">&quot;@apicase/adapter-fetch&quot;</span>

<span class="token keyword">const</span> doFetchRequest <span class="token operator">=</span> <span class="token function">apicase</span><span class="token punctuation">(</span>fetch<span class="token punctuation">)</span>
</code></pre><h2 id="request-structure"><a href="#request-structure" aria-hidden="true" class="header-anchor">#</a> Request structure</h2><p>The received function takes an object with the following format:</p><pre class="language-javascript"><code><span class="token function">doFetchRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/* Just payload */</span>
  <span class="token operator">...</span>payload<span class="token punctuation">,</span>
  <span class="token comment">/* Hooks object */</span>
  hooks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* You can pass a single hook */</span>
    before<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/* Or array of hooks */</span>
    done<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    fail<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Meta info that is passed only to hooks */</span>
  meta<span class="token punctuation">:</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Specific request options (we'll talk about it later) */</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>Simplest example:</p><pre class="language-javascript"><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">doFetchRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">&quot;/api/posts&quot;</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">&quot;GET&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h2 id="response-structure"><a href="#response-structure" aria-hidden="true" class="header-anchor">#</a> Response structure</h2><p>This function returns an object with <strong>state</strong>, <strong>on/off</strong> and **start/cancel **and <strong>then/catch</strong> methods</p><h3 id="state"><a href="#state" aria-hidden="true" class="header-anchor">#</a> State</h3><p>It's just some flags, payload and result</p><pre class="language-javascript"><code>request<span class="token punctuation">.</span>success <span class="token comment">// If request is finished successful</span>
request<span class="token punctuation">.</span>pending <span class="token comment">// If request is running</span>
request<span class="token punctuation">.</span>started <span class="token comment">// If request was started</span>
request<span class="token punctuation">.</span>cancelled <span class="token comment">// If request was cancelled</span>
request<span class="token punctuation">.</span>payload <span class="token comment">// Request payload (here: { url, method })</span>
request<span class="token punctuation">.</span>result <span class="token comment">// Result from adapter (can have initial state, if adapter has)</span>
</code></pre><h3 id="events"><a href="#events" aria-hidden="true" class="header-anchor">#</a> Events</h3><p>You can subscribe to events using <code>.on()</code> method and unsubscribe from 'em using <code>.off()</code></p><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On request success</span>
request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On request fail</span>
request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;finish&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On request finish (success doesn't matter)</span>
request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On request start</span>
request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;cancel&quot;</span><span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On request cancel</span>
request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// On JavaScript error happened</span>

request<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&quot;evt&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment">// Unsubscribe from event</span>

<span class="token comment">// Syntax sugar</span>
request<span class="token punctuation">.</span><span class="token function">onDone</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">===</span> request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
request<span class="token punctuation">.</span><span class="token function">onFail</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">===</span> request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
</code></pre><p>You can add as much events as you want</p><h3 id="start-and-cancel"><a href="#start-and-cancel" aria-hidden="true" class="header-anchor">#</a> Start and cancel</h3><p>You can <code>.start()</code> and <code>.cancel()</code> requests:</p><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Start request (see &quot;Requests+&quot; when we need to start manually)</span>
request<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Cancel request</span>
</code></pre><h3 id="then-and-catch-methods"><a href="#then-and-catch-methods" aria-hidden="true" class="header-anchor">#</a> Then and catch methods</h3><p>Apicase also gives you <code>.then()</code> and <code>.catch()</code> methods to feel like it's just a Promise:</p><pre class="language-javascript"><code><span class="token function">doFetchRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">&quot;/posts&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* Always resolved (even when request has failed */</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>state <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* Rejected only when JS error happened */</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>Since it returns thenable object, you can also use <code>async/await</code></p><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doFetchRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token punctuation">:</span> <span class="token string">'/posts'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h2 id="request-flow"><a href="#request-flow" aria-hidden="true" class="header-anchor">#</a> Request flow</h2><p>Apicase creates a queue of hooks and adapter call. Let's see this diagram</p><p><img src="/assets/img/flow.c0e1f75f.png" alt="Requests flow"></p><p>Hooks are used for request-level logic. All hooks are asynchronous and have callbacks to continue the queue. It allows you to do another requests, check something, just sleep and do whatever you want in hooks.</p><p>Events are used for application-level logic.You cannot change request state from them. They are just made to listen to it. Also some adapters may emit custom events (like <code>progress</code> in <code>xhr</code> adapter)</p><h2 id="detecting-state-changes"><a href="#detecting-state-changes" aria-hidden="true" class="header-anchor">#</a> Detecting state changes</h2><p>Apicase has 3 additional events that are emitted on state changes.</p><p>All of them have the following structure:</p><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change:state&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> prev<span class="token punctuation">,</span> next<span class="token punctuation">,</span> diff <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span> <span class="token comment">// Previous state</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token comment">// New state</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span> <span class="token comment">// Object with changed properties</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><ul><li><strong>change:state</strong> - on state changes (<code>success</code>, <code>pending</code>, <code>started</code>, <code>cancelled</code>, <code>payload</code>, <code>result</code>)</li><li><strong>change:payload</strong> - on payload only changes (<code>payload.url</code>, <code>payload.headers</code> etc)</li><li><strong>change:result</strong> - on result only changes (<code>result.body</code> etc)</li></ul><p>You can use it to create services and connect them with your store (e.g. Vuex)</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/quick-start.html" class="prev">
          Quick start
        </a></span><span class="next"><a href="/anatomy/services.html">
          Services
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/8.80949565.js" defer></script><script src="/assets/js/app.8395491c.js" defer></script>
  </body>
</html>
